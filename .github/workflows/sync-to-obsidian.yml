name: åŒæ­¥åˆ†æç»“æœåˆ° Obsidian Vault

on:
  # åœ¨ä¸»åˆ†æå®Œæˆåè¿è¡Œ
  workflow_run:
    workflows: ["æ¯æ—¥è‚¡ç¥¨åˆ†æ"]
    types:
      - completed
  workflow_dispatch:

jobs:
  sync:
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    runs-on: ubuntu-latest
    steps:
      - name: æ£€å‡ºæŠ¥å‘Š
        uses: actions/checkout@v4

      - name: åŒæ­¥åˆ° Obsidian
        env:
          GH_PAT: ${{ secrets.GH_PAT }}
          TARGET_REPO: ${{ secrets.TARGET_REPO }}
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          
          # å…‹éš† vault ä»“åº“
          git clone https://x-access-token:${GH_PAT}@github.com/${TARGET_REPO}.git vault
          
          # å¤åˆ¶æŠ¥å‘Š
          mkdir -p vault/è‚¡ç¥¨åˆ†æ/æ¯æ—¥å¤ç›˜
          cp reports/report_*.md vault/è‚¡ç¥¨åˆ†æ/æ¯æ—¥å¤ç›˜/ 2>/dev/null || true
          cp reports/market_review_*.md vault/è‚¡ç¥¨åˆ†æ/ 2>/dev/null || true
          
          # æäº¤
          cd vault
          git add .
          git diff --staged --quiet || git commit -m "ğŸ¤– æ›´æ–°åˆ†æ $(date '+%Y-%m-%d %H:%M')" && git push origin main
